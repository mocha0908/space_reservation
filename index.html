<!DOCTYPE html>
<html lang="ja" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬ãƒ»ãƒ¬ãƒ³ã‚¿ãƒ«ç”³è¾¼ | ãƒˆãƒ¬ã‚«ã‚­ãƒ³ã‚°ãƒ€ãƒ </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #ff0055;
            --background: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --accent-gold: #ffd700;
            --accent-blue: #00e5ff;
            --error: #ff3333;
        }

        body {
            background-color: var(--background);
            color: var(--text-main);
            font-family: 'Roboto', sans-serif;
            padding-bottom: 50px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(180deg, #1a0b14 0%, #121212 100%);
            border-bottom: 1px solid #333;
            margin-bottom: 20px;
        }
        h1 {
            font-family: 'Orbitron', sans-serif;
            color: #fff;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--primary);
        }

        /* ã‚«ãƒ¼ãƒ‰å…±é€š */
        .card {
            background-color: var(--card-bg);
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .card h3 {
            border-left: 4px solid var(--primary);
            padding-left: 10px;
            margin-bottom: 20px;
            color: #fff;
        }

        /* æŠ˜ã‚ŠãŸãŸã¿ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ */
        details.sim-box {
            background: #000;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 10px 20px;
            margin-bottom: 20px;
        }
        details.sim-box summary {
            font-weight: bold;
            color: var(--accent-blue);
            cursor: pointer;
            list-style: none; /* ä¸‰è§’ã‚’æ¶ˆã™ */
        }
        details.sim-box summary::after {
            content: " â–¼";
            font-size: 0.8em;
        }
        details.sim-box[open] summary::after {
            content: " â–²";
        }

        /* è¨ˆç®—çµæœã®æ•°å­— */
        .calc-row {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #333;
            padding: 5px 0;
            font-size: 0.9em;
        }
        .calc-total {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-weight: bold;
            font-size: 1.1em;
            color: var(--accent-gold);
        }
        .text-red { color: var(--error); }
        .text-blue { color: var(--accent-blue); }

        /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
        input, textarea, select {
            background-color: #2a2a2a !important;
            border: 1px solid #444 !important;
            color: #fff !important;
        }
        input:focus, textarea:focus {
            border-color: var(--primary) !important;
            box-shadow: 0 0 5px var(--primary) !important;
        }

        /* é€ä¿¡ãƒœã‚¿ãƒ³ */
        button[type="submit"] {
            background: var(--primary);
            border: none;
            font-weight: bold;
            font-size: 1.1em;
            padding: 15px;
            margin-top: 20px;
            width: 100%;
        }
        button[type="submit"]:hover {
            background-color: #cc0044;
        }

        /* ãƒ¬ãƒ³ã‚¸ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
        input[type=range] {
            height: 6px;
            background: #444;
            border-radius: 5px;
            outline: none;
        }
    </style>
</head>
<body>

    <header>
        <h1>Duel Space Booking</h1>
        <p>ãƒˆãƒ¬ã‚«ã‚­ãƒ³ã‚°ãƒ€ãƒ  ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬ç”³è¾¼</p>
    </header>

    <main class="container">

        <section class="card">
            <h3>ãƒ—ãƒ©ãƒ³æ¦‚è¦</h3>
            <div class="grid">
                <div>
                    <small>ä¼šå ´ãƒ¬ãƒ³ã‚¿ãƒ«æ–™</small><br>
                    <strong style="font-size:1.2em;">Â¥32,000</strong>
                </div>
                <div>
                    <small>å®šå“¡</small><br>
                    <strong>æœ€å¤§ 32å</strong>
                </div>
                <div>
                    <small>ç‰¹å…¸</small><br>
                    <span style="color:var(--accent-blue)">ä¼šå ´è²»å…¨é¡ãƒã‚¤ãƒ³ãƒˆé‚„å…ƒ</span>
                </div>
            </div>
        </section>

        <form id="reserveForm">
            
            <section class="card">
                <h3>ãŠç”³ã—è¾¼ã¿æƒ…å ±</h3>

                <label>ãŠåå‰ (ä¸»å‚¬è€…å)
                    <input type="text" name="name" required placeholder="ä¾‹ï¼šã‚­ãƒ³ã‚°ãƒ€ãƒ å¤ªéƒ">
                </label>

                <div class="grid">
                    <label>åˆ©ç”¨å¸Œæœ›æ—¥
                        <input type="date" name="date" required>
                    </label>
                    <label>é›»è©±ç•ªå·
                        <input type="tel" name="tel" required placeholder="090-0000-0000">
                    </label>
                </div>

                <label>åˆ©ç”¨ç”¨é€” (å¤§ä¼šåãƒ»å¯¾æˆ¦å½¢å¼ãªã©)
                    <input type="text" id="eventTitle" required placeholder="ä¾‹ï¼šç¬¬1å› ã‚­ãƒ³ã‚°ãƒ€ãƒ æ¯ï¼ˆäºˆé¸ã‚¹ã‚¤ã‚¹ãƒ‰ãƒ­ãƒ¼å½¢å¼ï¼‰">
                </label>
            </section>

            <details class="sim-box">
                <summary>ğŸ› ï¸ åæ”¯ãƒ»è³å“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ä½¿ã†ï¼ˆä»»æ„ï¼‰</summary>
                <div style="margin-top: 20px;">
                    <p><small>å‚åŠ è²»ã‚„äººæ•°ã‚’è¨­å®šã™ã‚‹ã¨ã€åç›Šã¨é…åˆ†å¯èƒ½ãªãƒã‚¤ãƒ³ãƒˆã‚’è¨ˆç®—ã§ãã¾ã™ã€‚<br>â€»ã“ã“ã§è¨­å®šã—ãŸå†…å®¹ã¯ç”³ã—è¾¼ã¿æ™‚ã«åº—èˆ—ã¸ä¼ã‚ã‚Šã¾ã™ã€‚</small></p>

                    <div class="grid">
                        <div>
                            <h5>ğŸ’° åç›Šäºˆæ¸¬</h5>
                            <label>å‚åŠ è²» (1äºº)
                                <input type="number" id="entryFee" value="2000" step="100">
                            </label>
                            <label>æƒ³å®šäººæ•°: <span id="playerCountDisplay" style="color:var(--accent-blue)">32å</span>
                                <input type="range" id="playerCountRange" min="1" max="32" value="32">
                            </label>

                            <div style="background:#222; padding:10px; border-radius:5px;">
                                <div class="calc-row">
                                    <span>å£²ä¸Šç·é¡</span>
                                    <span id="totalRevenue">Â¥64,000</span>
                                </div>
                                <div class="calc-row">
                                    <span>ä¼šå ´è²»</span>
                                    <span style="color:#ff8888">-Â¥32,000</span>
                                </div>
                                <div class="calc-total">
                                    <span>ä¸»å‚¬è€…åˆ©ç›Š</span>
                                    <span id="organizerProfit">Â¥32,000</span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h5>ğŸ ãƒã‚¤ãƒ³ãƒˆé…åˆ† (ä¿æœ‰: 32,000pt)</h5>
                            <label>å‚åŠ è³(å…¨å“¡/250pt~) <input type="number" id="prizePart" value="250" step="10"></label>
                            <div class="grid">
                                <label>å„ªå‹ <input type="number" id="prize1st" value="10000"></label>
                                <label>æº–å„ªå‹ <input type="number" id="prize2nd" value="5000"></label>
                            </div>
                            <div class="grid">
                                <label>Best4(å„1) <input type="number" id="prizeTop4" value="2500"></label>
                                <label>Best8(å„1) <input type="number" id="prizeTop8" value="0"></label>
                            </div>

                            <div style="text-align:right; margin-top:10px;">
                                <small>æ®‹ã‚Šãƒã‚¤ãƒ³ãƒˆ: </small>
                                <strong id="remainingPoints" style="font-size:1.2em; color:var(--accent-blue);">0 pt</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </details>

            <section class="card">
                <label>å‚™è€ƒãƒ»ãã®ä»– (ä»»æ„)
                    <textarea id="userMemo" rows="2" placeholder="è¨­å‚™ã«é–¢ã™ã‚‹è³ªå•ã‚„ã€é‹å–¶ä¸Šã®è¦æœ›ãªã©ãŒã‚ã‚Œã°ã”è¨˜å…¥ãã ã•ã„"></textarea>
                </label>

                <input type="hidden" name="purpose" id="finalPurpose">

                <hr style="border-color:#333; margin: 20px 0;">

                <div style="font-size: 0.9em;">
                    <label><input type="checkbox" required> å‚åŠ è€…å…¨å“¡ã®ã€Œä¼šå“¡ç™»éŒ²ã€ãŒå¿…é ˆã§ã™</label>
                    <label><input type="checkbox" required> åº—èˆ—ã‚¹ã‚¿ãƒƒãƒ•ã¯é‹å–¶è£œåŠ©ã‚’è¡Œã„ã¾ã›ã‚“</label>
                    <label><input type="checkbox" required> ãƒˆã‚¤ãƒ¬ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒ¼(HDMI/Type-C)ä½¿ç”¨å¯</label>
                </div>

                <button type="submit" id="submitBtn">äºˆç´„ã‚’ç”³ã—è¾¼ã‚€</button>
            </section>
        </form>

    </main>

    <script>
        // â˜…ã“ã“ã«GASã®URLã‚’è²¼ã‚Šä»˜ã‘
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyb1L9lbXiCFtR4hypvZSurkCHRLYwZIHO4vRxtU8ipyElckZGV5az30Kn-Dcr74qrN/exec';

        // --- å¤‰æ•°å®šç¾© ---
        const RENT_FEE = 32000;
        const TOTAL_POINTS = 32000;
        
        const inputs = {
            fee: document.getElementById('entryFee'),
            count: document.getElementById('playerCountRange'),
            part: document.getElementById('prizePart'),
            p1: document.getElementById('prize1st'),
            p2: document.getElementById('prize2nd'),
            p4: document.getElementById('prizeTop4'),
            p8: document.getElementById('prizeTop8'),
            eventTitle: document.getElementById('eventTitle'),
            userMemo: document.getElementById('userMemo')
        };

        const displays = {
            count: document.getElementById('playerCountDisplay'),
            revenue: document.getElementById('totalRevenue'),
            profit: document.getElementById('organizerProfit'),
            remPoints: document.getElementById('remainingPoints'),
            finalPurpose: document.getElementById('finalPurpose')
        };

        // --- è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ ---
        function calculate() {
            let players = parseInt(inputs.count.value);
            let fee = parseInt(inputs.fee.value) || 0;
            
            // åç›Šè¨ˆç®—
            let revenue = fee * players;
            let profit = revenue - RENT_FEE;

            displays.count.textContent = players + "å";
            displays.revenue.textContent = "Â¥" + revenue.toLocaleString();
            displays.profit.textContent = "Â¥" + profit.toLocaleString();
            
            // èµ¤å­—ãªã‚‰èµ¤æ–‡å­—ã«ã™ã‚‹ãŒã€é€ä¿¡ã¯æ­¢ã‚ãªã„
            displays.profit.className = profit < 0 ? "text-red" : "text-gold";

            // ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
            let pPart = parseInt(inputs.part.value) || 0;
            let p1 = parseInt(inputs.p1.value) || 0;
            let p2 = parseInt(inputs.p2.value) || 0;
            let p4 = parseInt(inputs.p4.value) || 0;
            let p8 = parseInt(inputs.p8.value) || 0;

            let used = (pPart * players) + p1 + p2 + (p4 * 2) + (p8 * 4);
            let remain = TOTAL_POINTS - used;

            displays.remPoints.textContent = remain.toLocaleString() + " pt";
            
            // ãƒã‚¤ãƒ³ãƒˆä¸è¶³æ™‚ã®è­¦å‘Šï¼ˆèµ¤æ–‡å­—ã«ã™ã‚‹ã ã‘ï¼‰
            if(remain < 0) {
                displays.remPoints.style.color = "#ff3333";
                displays.remPoints.textContent += " (ä¸è¶³)";
            } else {
                displays.remPoints.style.color = "#00e5ff";
            }

            // é€ä¿¡ãƒ‡ãƒ¼ã‚¿ã®çµåˆå‡¦ç†
            // GASå´ã‚’å¤‰ãˆãšã«æ¸ˆã‚€ã‚ˆã†ã€å…¨ã¦ã®æƒ…å ±ã‚’ã€Œåˆ©ç”¨ç”¨é€”(purpose)ã€ã«ã¾ã¨ã‚ã¦é€ã‚‹
            let combinedText = `ã€å¤§ä¼šåã€‘ ${inputs.eventTitle.value}\n\n` +
                               `ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœã€‘\n` +
                               `ãƒ»æƒ³å®šäººæ•°: ${players}å / å‚åŠ è²»: ${fee}å††\n` +
                               `ãƒ»äºˆæƒ³å£²ä¸Š: ${revenue}å†† (åˆ©ç›Š: ${profit}å††)\n` +
                               `ãƒ»ãƒã‚¤ãƒ³ãƒˆé…åˆ†: å‚åŠ è³${pPart} / å„ªå‹${p1} / 2ä½${p2} ... (æ®‹${remain}pt)\n\n` +
                               `ã€å‚™è€ƒãƒ»ãã®ä»–ã€‘\n${inputs.userMemo.value}`;
            
            displays.finalPurpose.value = combinedText;
        }

        // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ ---
        Object.values(inputs).forEach(el => {
            el.addEventListener('input', calculate);
        });

        calculate(); // åˆæœŸå®Ÿè¡Œ

        // --- é€ä¿¡å‡¦ç† ---
        const form = document.getElementById('reserveForm');
        const btn = document.getElementById('submitBtn');

        form.addEventListener('submit', e => {
            e.preventDefault();
            calculate(); // é€ä¿¡ç›´å‰ã«æœ€æ–°å€¤ã‚’ã‚»ãƒƒãƒˆ
            
            btn.disabled = true;
            btn.innerText = "é€ä¿¡ä¸­...";
            
            const formData = new FormData(form);
            
            fetch(SCRIPT_URL, { method: 'POST', body: formData })
                .then(res => {
                    alert('âœ… ç”³ã—è¾¼ã¿å®Œäº†\n\nåº—èˆ—ã‹ã‚‰ã®é€£çµ¡ã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚');
                    form.reset();
                    // ãƒªã‚»ãƒƒãƒˆå¾Œã«åˆæœŸå€¤ã‚’æˆ»ã™
                    inputs.fee.value = 2000;
                    inputs.count.value = 32;
                    calculate();
                    btn.disabled = false;
                    btn.innerText = "äºˆç´„ã‚’ç”³ã—è¾¼ã‚€";
                })
                .catch(err => {
                    alert('âœ… é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†');
                    form.reset();
                    btn.disabled = false;
                    btn.innerText = "äºˆç´„ã‚’ç”³ã—è¾¼ã‚€";
                });
        });
    </script>
</body>
</html>
