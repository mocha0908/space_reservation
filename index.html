<!DOCTYPE html>
<html lang="ja" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬ãƒ»ãƒ¬ãƒ³ã‚¿ãƒ«ç”³è¾¼ | ãƒˆãƒ¬ã‚«ã‚­ãƒ³ã‚°ãƒ€ãƒ </title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #ff0055;
            --primary-hover: #cc0044;
            --background: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --accent-gold: #ffd700;
            --accent-blue: #00e5ff;
            --success: #00ff88;
            --error: #ff3333;
        }

        body {
            background-color: var(--background);
            color: var(--text-main);
            font-family: 'Roboto', sans-serif;
            padding-bottom: 50px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ */
        header {
            text-align: center;
            padding: 40px 20px;
            background: linear-gradient(135deg, #1a0b14 0%, #000000 100%);
            border-bottom: 2px solid var(--primary);
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.2);
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
            text-shadow: 0 0 10px var(--primary);
        }

        /* ã‚«ãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠ */
        .card {
            background-color: var(--card-bg);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .card h3 {
            border-left: 4px solid var(--primary);
            padding-left: 15px;
            color: #fff;
            margin-bottom: 20px;
        }

        /* ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒªã‚¢ */
        .sim-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .sim-grid { grid-template-columns: 1fr; }
        }

        .result-box {
            background: #000;
            border: 1px solid #444;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 10px;
        }

        .result-value {
            font-size: 1.8em;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            display: block;
        }
        .text-gold { color: var(--accent-gold); }
        .text-blue { color: var(--accent-blue); }
        .text-green { color: var(--success); }
        .text-red { color: var(--error); }

        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ èª¿æ•´ */
        input[type="number"], input[type="text"], input[type="tel"], input[type="date"], textarea {
            background-color: #2a2a2a;
            border: 1px solid #444;
            color: #fff;
        }
        input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 5px var(--primary);
        }

        label small { color: #888; }

        /* é€ä¿¡ãƒœã‚¿ãƒ³ */
        button[type="submit"] {
            background: linear-gradient(45deg, var(--primary), #ff5e00);
            border: none;
            font-weight: bold;
            font-size: 1.2em;
            padding: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.2s;
        }
        button[type="submit"]:hover {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.6);
        }

        /* ãƒã‚¤ãƒ³ãƒˆæ®‹é‡ãƒãƒ¼ */
        .progress-bar-bg {
            background: #333;
            height: 10px;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        .progress-bar-fill {
            background: var(--accent-blue);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease, background-color 0.3s;
        }

    </style>
</head>
<body>

    <header>
        <h1>Duel Space Booking</h1>
        <p>ãƒˆãƒ¬ã‚«ã‚­ãƒ³ã‚°ãƒ€ãƒ  ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬ãƒ»ãƒ¬ãƒ³ã‚¿ãƒ«ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ </p>
    </header>

    <main class="container">

        <section class="card">
            <h3>Step 1. é–‹å‚¬ãƒ—ãƒ©ãƒ³ã¨å®šå“¡</h3>
            <div class="grid">
                <div>
                    <strong>ğŸ“¦ ä¼šå ´ãƒ¬ãƒ³ã‚¿ãƒ«æ–™</strong>
                    <div class="result-value">Â¥32,000</div>
                    <small>ï¼ˆæ™‚é–“ï¼š12:00 - 19:00ï¼‰</small>
                </div>
                <div>
                    <strong>ğŸ’ ãƒã‚¤ãƒ³ãƒˆé‚„å…ƒ</strong>
                    <div class="result-value text-blue">32,000 pt</div>
                    <small>ä¼šå ´è²»å…¨é¡ã‚’è³å“ãƒã‚¤ãƒ³ãƒˆã¨ã—ã¦é‚„å…ƒï¼</small>
                </div>
                <div>
                    <strong>ğŸ‘¥ æœ€å¤§å®šå“¡</strong>
                    <div class="result-value">32å</div>
                </div>
            </div>
        </section>

        <section class="card">
            <h3>Step 2. åæ”¯ï¼†è³å“ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h3>
            <p><small>ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ã¦ã€ã‚ãªãŸã®å¤§ä¼šãƒ—ãƒ©ãƒ³ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚ã“ã®å†…å®¹ã¯è‡ªå‹•çš„ã«ç”³ã—è¾¼ã¿ãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜ ã•ã‚Œã¾ã™ã€‚</small></p>
            
            <div class="sim-grid">
                <div>
                    <h4 style="border-bottom: 1px solid #444; padding-bottom: 5px;">ğŸ’° åç›Šäºˆæ¸¬</h4>
                    <label>
                        å‚åŠ è²»è¨­å®š (1äººã‚ãŸã‚Š)
                        <input type="number" id="entryFee" value="2000" min="0" step="100">
                    </label>
                    <label>
                        æƒ³å®šå‚åŠ äººæ•° (æœ€å¤§32å)
                        <input type="range" id="playerCountRange" min="1" max="32" value="32">
                        <div style="display:flex; justify-content:space-between;">
                            <span>1å</span>
                            <span id="playerCountDisplay" style="font-weight:bold; color:var(--primary);">32å</span>
                            <span>32å</span>
                        </div>
                    </label>
                    
                    <div class="result-box">
                        <small>ä¸»å‚¬è€…æ‰‹æ®‹ã‚Šåˆ©ç›Š (å£²ä¸Š - ä¼šå ´è²»)</small>
                        <span id="organizerProfit" class="result-value text-gold">Â¥32,000</span>
                    </div>
                </div>

                <div>
                    <h4 style="border-bottom: 1px solid #444; padding-bottom: 5px;">ğŸ è³å“ãƒã‚¤ãƒ³ãƒˆé…åˆ† (ç·é¡32,000pt)</h4>
                    
                    <label>
                        å‚åŠ è³ (å…¨å“¡) <small>â€»æœ€ä½250ptå¿…é ˆ</small>
                        <input type="number" id="prizePart" value="250" min="250" step="10">
                    </label>

                    <div class="grid">
                        <label>å„ªå‹ <input type="number" id="prize1st" value="10000" step="100"></label>
                        <label>æº–å„ªå‹ <input type="number" id="prize2nd" value="5000" step="100"></label>
                    </div>
                    <div class="grid">
                        <label>Best4 <small>(å„1å)</small> <input type="number" id="prizeTop4" value="2500" step="100"></label>
                        <label>Best8 <small>(å„1å)</small> <input type="number" id="prizeTop8" value="0" step="100"></label>
                    </div>

                    <div class="result-box">
                        <small>æœªé…åˆ†ã®æ®‹ã‚Šãƒã‚¤ãƒ³ãƒˆ</small>
                        <span id="remainingPoints" class="result-value text-blue">0 pt</span>
                        <div class="progress-bar-bg">
                            <div id="pointBar" class="progress-bar-fill"></div>
                        </div>
                        <small id="pointStatus" style="color:#888;">é…åˆ†å®Œäº†ï¼</small>
                    </div>
                </div>
            </div>
        </section>

        <form id="reserveForm">
            <section class="card">
                <h3>Step 3. ç”³ã—è¾¼ã¿æƒ…å ±å…¥åŠ›</h3>

                <label>ãŠåå‰ (ä¸»å‚¬è€…å)
                    <input type="text" name="name" required placeholder="ä¾‹ï¼šã‚­ãƒ³ã‚°ãƒ€ãƒ å¤ªéƒ">
                </label>

                <label>åˆ©ç”¨å¸Œæœ›æ—¥
                    <input type="date" name="date" required>
                </label>

                <label>é›»è©±ç•ªå·
                    <input type="tel" name="tel" required placeholder="090-0000-0000">
                </label>

                <input type="hidden" name="purpose" id="purposeHidden">

                <label>å‚™è€ƒãƒ»ãã®ä»– (ä»»æ„)
                    <textarea id="userMemo" rows="2" placeholder="ç‰¹å®šã®ã‚¿ã‚¤ãƒˆãƒ«ã€ç‹¬è‡ªã®ãƒ«ãƒ¼ãƒ«ãªã©ãŒã‚ã‚Œã°è¨˜è¼‰ã—ã¦ãã ã•ã„"></textarea>
                </label>

                <hr style="border-color:#444;">

                <label>
                    <input type="checkbox" required>
                    <strong>ã€é‡è¦ã€‘å‚åŠ è€…å…¨å“¡ã®ã€Œä¼šå“¡ç™»éŒ²ã€ãŒå¿…é ˆã§ã™</strong>
                </label>
                <label>
                    <input type="checkbox" required>
                    åº—èˆ—ã‚¹ã‚¿ãƒƒãƒ•ã¯é‹å–¶è£œåŠ©ï¼ˆã‚¸ãƒ£ãƒƒã‚¸ç­‰ï¼‰ã‚’è¡Œãˆã¾ã›ã‚“
                </label>
                <label>
                    <input type="checkbox" required>
                    ãƒˆã‚¤ãƒ¬ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒ¼(HDMI/Type-C)ã®ä½¿ç”¨å¯
                </label>

                <button type="submit" id="submitBtn" style="width:100%; margin-top:20px;">
                    ã“ã®ãƒ—ãƒ©ãƒ³ã§äºˆç´„ã‚’ç”³ã—è¾¼ã‚€
                </button>
            </section>
        </form>

    </main>

    <script>
        // â˜…ã“ã“ã«Google Apps Scriptã®URLã‚’è²¼ã‚‹
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyb1L9lbXiCFtR4hypvZSurkCHRLYwZIHO4vRxtU8ipyElckZGV5az30Kn-Dcr74qrN/exec';

        // --- ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ ãƒ­ã‚¸ãƒƒã‚¯ ---
        const RENT_FEE = 32000;
        const TOTAL_POINTS = 32000;
        const MAX_PLAYERS = 32;

        const inputs = {
            entryFee: document.getElementById('entryFee'),
            countRange: document.getElementById('playerCountRange'),
            countDisplay: document.getElementById('playerCountDisplay'),
            part: document.getElementById('prizePart'),
            p1: document.getElementById('prize1st'),
            p2: document.getElementById('prize2nd'),
            p4: document.getElementById('prizeTop4'), // 2ååˆ†
            p8: document.getElementById('prizeTop8'), // 4ååˆ†
        };

        const displays = {
            profit: document.getElementById('organizerProfit'),
            remPoints: document.getElementById('remainingPoints'),
            status: document.getElementById('pointStatus'),
            bar: document.getElementById('pointBar'),
            purposeHidden: document.getElementById('purposeHidden'),
            userMemo: document.getElementById('userMemo')
        };

        function calculate() {
            // å€¤ã®å–å¾—
            let players = parseInt(inputs.countRange.value);
            let fee = parseInt(inputs.entryFee.value) || 0;
            let partPt = parseInt(inputs.part.value) || 0;
            let p1 = parseInt(inputs.p1.value) || 0;
            let p2 = parseInt(inputs.p2.value) || 0;
            let p4 = parseInt(inputs.p4.value) || 0;
            let p8 = parseInt(inputs.p8.value) || 0;

            // è¡¨ç¤ºæ›´æ–°
            inputs.countDisplay.textContent = players + "å";

            // 1. åç›Šè¨ˆç®—
            let revenue = fee * players;
            let profit = revenue - RENT_FEE;
            displays.profit.textContent = "Â¥" + profit.toLocaleString();
            displays.profit.className = profit >= 0 ? "result-value text-gold" : "result-value text-red";

            // 2. ãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
            // Best4ã¯3ä½ã¨4ä½ã®2åã€Best8ã¯5ä½~8ä½ã®4å
            // å‚åŠ è³ã¯å…¨å“¡ã«é…ã‚‹
            let usedPoints = (partPt * players) + p1 + p2 + (p4 * 2) + (p8 * 4);
            let remaining = TOTAL_POINTS - usedPoints;

            displays.remPoints.textContent = remaining.toLocaleString() + " pt";
            
            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã¨è­¦å‘Š
            let usagePercent = (usedPoints / TOTAL_POINTS) * 100;
            if (usagePercent > 100) usagePercent = 100;
            displays.bar.style.width = usagePercent + "%";

            if (remaining < 0) {
                displays.remPoints.className = "result-value text-red";
                displays.status.textContent = "âš ï¸ ãƒã‚¤ãƒ³ãƒˆãŒä¸è¶³ã—ã¦ã„ã¾ã™ï¼é…åˆ†ã‚’æ¸›ã‚‰ã—ã¦ãã ã•ã„";
                displays.status.style.color = "#ff3333";
                displays.bar.style.backgroundColor = "#ff3333";
                document.getElementById('submitBtn').disabled = true; // é€ä¿¡ä¸å¯ã«ã™ã‚‹
                document.getElementById('submitBtn').innerText = "ãƒã‚¤ãƒ³ãƒˆé…åˆ†ã‚’ä¿®æ­£ã—ã¦ãã ã•ã„";
            } else {
                displays.remPoints.className = "result-value text-blue";
                displays.status.textContent = "ã“ã®é…åˆ†ã§OK";
                displays.status.style.color = "#00ff88";
                displays.bar.style.backgroundColor = "#00e5ff";
                document.getElementById('submitBtn').disabled = false;
                document.getElementById('submitBtn').innerText = "ã“ã®ãƒ—ãƒ©ãƒ³ã§äºˆç´„ã‚’ç”³ã—è¾¼ã‚€";
            }

            updateHiddenPurpose(players, fee, profit, partPt, p1, p2, p4, p8);
        }

        function updateHiddenPurpose(players, fee, profit, part, p1, p2, p4, p8) {
            // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œåˆ©ç”¨ç”¨é€”ã€æ¬„ã«é€ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
            let planText = `ã€å¤§ä¼šãƒ—ãƒ©ãƒ³ã€‘\n` +
                           `ãƒ»å‚åŠ è²»: ${fee}å†† Ã— ${players}åæƒ³å®š\n` +
                           `ãƒ»äºˆæƒ³åˆ©ç›Š: ${profit}å††\n` +
                           `ãƒ»ãƒã‚¤ãƒ³ãƒˆé…åˆ†: å‚åŠ è³${part}pt / å„ªå‹${p1}pt / 2ä½${p2}pt / Best4 ${p4}pt / Best8 ${p8}pt\n`;
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è‡ªç”±è¨˜è¿°ãƒ¡ãƒ¢ãŒã‚ã‚Œã°è¿½åŠ 
            let memo = displays.userMemo.value;
            displays.purposeHidden.value = planText + (memo ? `\nã€å‚™è€ƒã€‘\n${memo}` : "");
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', calculate);
        });
        displays.userMemo.addEventListener('input', calculate);

        // åˆæœŸè¨ˆç®—å®Ÿè¡Œ
        calculate();


        // --- é€ä¿¡å‡¦ç† ---
        const form = document.getElementById('reserveForm');
        const btn = document.getElementById('submitBtn');

        form.addEventListener('submit', e => {
            e.preventDefault();
            
            // é€ä¿¡ç›´å‰ã«å€¤ã‚’å†ã‚»ãƒƒãƒˆï¼ˆå¿µã®ãŸã‚ï¼‰
            calculate();

            btn.disabled = true;
            btn.innerText = "é€ä¿¡ä¸­...";

            const formData = new FormData(form);
            
            fetch(SCRIPT_URL, { method: 'POST', body: formData })
                .then(response => {
                    alert('âœ… ç”³ã—è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nåº—èˆ—æ‹…å½“è€…ã‚ˆã‚ŠæŠ˜ã‚Šè¿”ã—ã”é€£çµ¡ã„ãŸã—ã¾ã™ã€‚\nï¼ˆç¢ºå®šã¾ã§ä»Šã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ï¼‰');
                    form.reset();
                    // ãƒªã‚»ãƒƒãƒˆå¾Œã€åˆæœŸå€¤ã‚’å†è¨ˆç®—
                    setTimeout(calculate, 100);
                })
                .catch(error => {
                    // GASã¯æˆåŠŸæ™‚ã‚‚CORSã‚¨ãƒ©ãƒ¼ã£ã½ãè¦‹ãˆã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚
                    alert('âœ… é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†\n\nå¿µã®ãŸã‚ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ã”ç¢ºèªãã ã•ã„ã€‚');
                    form.reset();
                    setTimeout(calculate, 100);
                });
        });
    </script>
</body>
</html>
